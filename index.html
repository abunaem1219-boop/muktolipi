<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶≤‡¶ø‡¶™‡¶ø ‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø</title>
    
    <!-- PWA Manifest & Meta Tags -->
    <meta name="theme-color" content="#1877f2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="‡¶Æ‡¶®‡ßá‡¶∞ ‡¶ï‡¶•‡¶æ, ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§ ‡¶≠‡¶æ‡¶∑‡¶æ‡ßü - ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶≤‡¶ø‡¶™‡¶ø ‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Galada&family=Hind+Siliguri:wght@300;400;500;600;700&family=Noto+Serif+Bengali:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root { 
            --bg-color: #f0f2f5; 
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --glass-blur: blur(12px);
            --text-color: #1c1e21; 
            --primary-color: #1877f2; 
            --border-color: rgba(0,0,0,0.1); 
            --secondary-text: #65676b; 
            --content-font-size: 17px;
            --highlight-color: #fff3cd;
            --shadow-card: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            --safe-area-bottom: env(safe-area-inset-bottom);
            --current-font: 'Hind Siliguri', sans-serif;
        }
        .dark-theme { 
            --bg-color: #101112; 
            --glass-bg: rgba(36, 37, 38, 0.9);
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --text-color: #e4e6eb; 
            --primary-color: #4595ff; 
            --border-color: rgba(255,255,255,0.1); 
            --secondary-text: #b0b3b8; 
            --highlight-color: #584c06;
            --shadow-card: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        body { font-family: var(--current-font); background: var(--bg-color); color: var(--text-color); margin: 0; padding: 0 0 100px 0; transition: background 0.3s, color 0.3s; user-select: none; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            box-shadow: var(--shadow-card);
        }

        /* Reading Progress Bar */
        #readingProgress { position: fixed; top: 0; left: 0; width: 0%; height: 4px; background: linear-gradient(90deg, #1877f2, #00c6ff); z-index: 9999; transition: width 0.1s; }

        .container { max-width: 800px; margin: 0 auto; padding: 75px 10px 10px 10px; }

        /* Header & Controls */
        .sticky-controls { 
            padding: 10px; display: flex; justify-content: center; gap: 20px; 
            position: fixed; top: 0; left: 0; width: 100%; box-sizing: border-box; 
            z-index: 1100; border-radius: 0 0 16px 16px; transition: background 0.3s; 
        }
        .icon-btn { cursor: pointer; font-size: 18px; background: none; border: none; color: var(--text-color); padding: 8px; transition: transform 0.2s; border-radius: 50%; background: rgba(0,0,0,0.05); }
        .icon-btn:active { transform: scale(0.9); }

        .header-title-block { padding: 5px 15px 10px 15px; text-align: center; margin-bottom: 10px; cursor: pointer; }

        /* Stories Bar */
        .stories-container { display: flex; gap: 12px; overflow-x: auto; padding: 10px 5px; margin-bottom: 15px; scrollbar-width: none; }
        .stories-container::-webkit-scrollbar { display: none; }
        .story-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; min-width: 65px; }
        .story-ring { width: 55px; height: 55px; border-radius: 50%; padding: 2px; background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888, #232323); display: flex; align-items: center; justify-content: center; margin-bottom: 5px; }
        .story-img { width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--bg-color); object-fit: cover; background: #fff; }
        .story-name { font-size: 11px; color: var(--text-color); text-align: center; max-width: 70px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Search & Tabs */
        .search-wrapper { position: relative; margin-bottom: 15px; display: flex; gap:10px; align-items: center;}
        #searchBar { width: 100%; padding: 12px 40px 12px 20px; border-radius: 30px; border: 1px solid var(--border-color); background: var(--glass-bg); color: var(--text-color); outline: none; box-sizing: border-box; font-size: 16px; box-shadow: var(--shadow-soft); }
        .category-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .cat-btn { white-space: nowrap; padding: 8px 16px; border-radius: 20px; border: 1px solid transparent; background: rgba(0,0,0,0.05); color: var(--text-color); cursor: pointer; font-size: 14px; transition: 0.2s; font-family: inherit; }
        .cat-btn.active { background: var(--primary-color); color: white; }

        /* Post Card */
        .post-card { padding: 15px; border-radius: 16px; margin-bottom: 20px; position: relative; overflow: hidden; }
        .author-info { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .avatar-circle { width: 40px; height: 40px; background: #e4e6eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;}
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
        .post-title { font-size: 20px; margin: 5px 0 10px 0; font-weight: 700; line-height: 1.3; }
        
        /* Updated Image Styling */
        .post-img-container { position: relative; width: 100%; border-radius: 12px; overflow: hidden; margin: 0 0 15px 0; background: #eee; cursor: pointer; }
        .post-img { width: 100%; display: block; height: auto; max-height: 500px; object-fit: cover; transition: transform 0.3s; }
        
        .content-preview { font-size: var(--content-font-size); line-height: 1.6; color: var(--text-color); white-space: pre-wrap; margin-bottom: 10px; }
        
        /* Like Animations */
        .interaction-bar { display: flex; justify-content: space-between; border-top: 1px solid var(--border-color); padding-top: 10px; margin-top: 8px; }
        .action-btn { background: none; border: none; cursor: pointer; color: var(--secondary-text); font-size: 14px; display: flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 6px; transition: 0.2s; position: relative; }
        .action-btn.liked { color: #e74c3c; animation: popBtn 0.3s ease; }
        @keyframes popBtn { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        
        /* Double Tap Heart */
        .insta-heart { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); color: white; font-size: 80px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); z-index: 10; pointer-events: none; opacity: 0; }
        .insta-heart.active { animation: popHeartInsta 0.8s ease-out forwards; }
        @keyframes popHeartInsta { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 15% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 30% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; } }

        /* Media & Read More */
        .media-controls { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .media-btn { background: rgba(24, 119, 242, 0.08); padding: 8px 12px; border-radius: 12px; color: var(--primary-color); font-size: 13px; border: none; cursor: pointer; }
        .read-more-wrapper { overflow: hidden; transition: max-height 0.4s ease; max-height: 120px; position: relative; }
        .read-more-wrapper.expanded { max-height: none; }
        .read-more-overlay::after { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 60px; background: linear-gradient(to bottom, transparent, var(--bg-color)); pointer-events: none; }
        .read-more-btn { color: var(--primary-color); border: none; background: none; padding: 5px 0; font-size: 14px; cursor: pointer; margin-top: 5px; display: none; }

        /* Comments */
        .comments-container { display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color); }
        .comment-input { width: 100%; padding: 8px; border-radius: 20px; border: 1px solid var(--border-color); background: rgba(0,0,0,0.03); outline: none; }

        /* Bottom Nav */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; 
            display: flex; justify-content: space-around; align-items: center; 
            z-index: 1500; padding: 0 10px; padding-bottom: var(--safe-area-bottom); 
            box-sizing: border-box; background: var(--glass-bg); backdrop-filter: var(--glass-blur);
            border-top: var(--glass-border); box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--secondary-text); background: none; border: none; font-size: 10px; cursor: pointer; width: 60px; position: relative; }
        .nav-item i { font-size: 22px; margin-bottom: 4px; transition: 0.2s; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item.active i { transform: translateY(-2px); }
        .nav-item.active::after { content: ''; position: absolute; bottom: -5px; width: 4px; height: 4px; background: var(--primary-color); border-radius: 50%; }
        .badge { position: absolute; top: -5px; right: 10px; background: #e74c3c; color: white; border-radius: 50%; padding: 2px 5px; font-size: 9px; display: none; border: 2px solid var(--bg-color); }
        .badge.active { display: block; }

        /* Floating Write Button */
        .nav-center-btn { 
            background: var(--primary-color); color: white; border: none; 
            width: 55px; height: 55px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 22px; cursor: pointer; 
            transform: translateY(-25px); 
            box-shadow: 0 4px 15px rgba(24, 119, 242, 0.4); 
            border: 4px solid var(--bg-color); transition: transform 0.2s;
        }
        .nav-center-btn:active { transform: translateY(-20px) scale(0.95); }

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2100; display: none; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; backdrop-filter: blur(8px); }
        .modal-content { background: var(--bg-color); padding: 20px; border-radius: 16px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 12px; }

        /* Form Elements */
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.02); color: var(--text-color); box-sizing: border-box; outline: none; }
        .rich-editor { min-height: 150px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.02); outline: none; max-height: 300px; overflow-y: auto; }
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; font-size: 15px; }
        .btn-primary { background: var(--primary-color); color: white; }
        .file-upload-box { border: 2px dashed var(--border-color); padding: 15px; text-align: center; border-radius: 8px; cursor: pointer; color: var(--secondary-text); font-size: 13px; }
        
        /* Profile Modal Styles */
        .profile-header { text-align: center; margin-bottom: 15px; }
        .profile-img-lg { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary-color); margin-bottom: 10px; }
        .profile-stat-box { display: flex; justify-content: center; gap: 20px; font-size: 13px; color: var(--secondary-text); margin-bottom: 15px; }
        .my-posts-list { max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .my-post-item { padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }

        /* Utilities */
        .toast-box { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); color: white; padding: 10px 20px; border-radius: 30px; font-size: 13px; z-index: 3000; opacity: 0; pointer-events: none; transition: 0.3s; white-space: nowrap; }
        .toast-box.show { opacity: 1; }
        .skeleton { background: var(--glass-bg); padding: 20px; border-radius: 16px; margin-bottom: 20px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* Zen Mode */
        body.zen-active .sticky-controls, body.zen-active .bottom-nav, body.zen-active .category-tabs, body.zen-active .search-wrapper { display: none !important; }
        .zen-exit-btn { display: none; position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 30px; z-index: 2000; border: none; }
        body.zen-active .zen-exit-btn { display: block; }

        /* Audio Player */
        #stickyPlayer { position: fixed; bottom: -100px; left: 0; width: 100%; background: var(--glass-bg); padding: 10px; z-index: 1400; transition: bottom 0.4s; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; backdrop-filter: blur(10px); box-shadow: 0 -5px 15px rgba(0,0,0,0.1); border-radius: 15px 15px 0 0; }
        #stickyPlayer.active { bottom: 65px; }
    </style>
</head>
<body>

    <!-- Progress & Toast -->
    <div id="readingProgress"></div>
    <div id="toast" class="toast-box"><span id="toastMsg"></span></div>
    <button class="zen-exit-btn" onclick="toggleZenMode()"><i class="fas fa-compress"></i></button>

    <!-- Top Controls -->
    <div class="sticky-controls glass-panel">
        <button class="icon-btn" onclick="toggleFontSize()"><i class="fas fa-text-height"></i></button>
        <button class="icon-btn" onclick="toggleFontFamily()"><i class="fas fa-font"></i></button>
        <button class="icon-btn" onclick="toggleZenMode()"><i class="fas fa-expand"></i></button>
        <button class="icon-btn" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header-title-block" onclick="handleSecretTap()">
            <h1 style="margin:0; font-size:24px; color:var(--primary-color);">‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶≤‡¶ø‡¶™‡¶ø ‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø</h1>
            <p style="margin:2px 0 0; font-size:13px; color:var(--secondary-text);">‡¶Æ‡¶®‡ßá‡¶∞ ‡¶ï‡¶•‡¶æ, ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§ ‡¶≠‡¶æ‡¶∑‡¶æ‡ßü</p>
        </div>

        <!-- Stories -->
        <div id="storiesBar" class="stories-container"></div>

        <!-- Search & Tabs -->
        <div class="search-wrapper">
            <input type="text" id="searchBar" placeholder="üîç ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="filterPosts(this.value)">
            <button class="leaderboard-btn icon-btn" onclick="showLeaderboard()"><i class="fas fa-trophy" style="color:#f1c40f"></i></button>
        </div>
        <div class="category-tabs">
            <button class="cat-btn active" onclick="filterCategory('‡¶∏‡¶¨', this)">‡¶∏‡¶¨</button>
            <button class="cat-btn" onclick="filterCategory('‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü', this)">üî• ‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü</button>
            <button class="cat-btn" onclick="filterCategory('‡¶ó‡¶≤‡ßç‡¶™', this)">‡¶ó‡¶≤‡ßç‡¶™</button>
            <button class="cat-btn" onclick="filterCategory('‡¶ï‡¶¨‡¶ø‡¶§‡¶æ', this)">‡¶ï‡¶¨‡¶ø‡¶§‡¶æ</button>
            <button class="cat-btn" onclick="filterCategory('‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø', this)">‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø</button>
            <button class="cat-btn" onclick="filterCategory('‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï', this)">‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï</button>
        </div>

        <!-- Feed -->
        <div id="skeletonLoader">
            <div class="skeleton" style="height:200px"></div>
            <div class="skeleton" style="height:200px"></div>
        </div>
        <div id="feed"></div>
    </div>

    <!-- Audio Player -->
    <div id="stickyPlayer">
        <div style="width:70%; overflow:hidden;">
            <div id="playerTitle" style="font-weight:bold; font-size:13px; white-space:nowrap;">Title</div>
            <div id="playerAuthor" style="font-size:11px;">Author</div>
        </div>
        <div>
            <button onclick="toggleAudio()" style="background:none; border:none; color:var(--primary-color); font-size:24px;"><i id="playIcon" class="fas fa-play"></i></button>
            <button onclick="closePlayer()" style="background:none; border:none;"><i class="fas fa-times"></i></button>
        </div>
        <audio id="globalAudio" onended="audioEnded()"></audio>
    </div>

    <!-- 5-Item Bottom Nav -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="navTo('home', this)">
            <i class="fas fa-home"></i> <span>‡¶π‡ßã‡¶Æ</span>
        </button>
        <button class="nav-item" onclick="navTo('search', this)">
            <i class="fas fa-search"></i> <span>‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</span>
        </button>
        
        <!-- FAB Write -->
        <button class="nav-center-btn" onclick="openWriteModal()">
            <i class="fas fa-pen-nib"></i>
        </button>
        
        <button class="nav-item" onclick="navTo('notifications', this)">
            <i class="fas fa-bell"></i> <span>‡¶®‡ßã‡¶ü‡¶ø‡¶∂</span>
            <span id="notifBadge" class="badge">0</span>
        </button>
        <button class="nav-item" onclick="navTo('profile', this)">
            <i class="fas fa-user"></i> <span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span>
        </button>
    </nav>

    <!-- Write/Edit Modal -->
    <div id="writeModalWrapper" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 id="formTitle" style="margin:0;">‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</h3>
                <button onclick="closeWriteModal()" style="background:none; border:none; font-size:20px;"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="authRequiredMsg" style="text-align:center; padding:20px; display:none;">
                <p>‡¶≤‡ßá‡¶ñ‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                <button class="btn google-btn" onclick="login()"><i class="fab fa-google"></i> ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶≤‡¶ó‡¶á‡¶®</button>
            </div>

            <div id="writeForm">
                <input type="hidden" id="editKey">
                <input type="text" id="postTitle" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
                <select id="postCategory" style="margin-top:10px;">
                    <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="‡¶ó‡¶≤‡ßç‡¶™">‡¶ó‡¶≤‡ßç‡¶™</option>
                    <option value="‡¶ï‡¶¨‡¶ø‡¶§‡¶æ">‡¶ï‡¶¨‡¶ø‡¶§‡¶æ</option>
                    <option value="‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø">‡¶°‡¶æ‡ßü‡ßá‡¶∞‡¶ø</option>
                    <option value="‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï">‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï</option>
                </select>

                <!-- Rich Editor -->
                <div style="margin-top:10px;">
                    <div style="background:#ddd; padding:5px; border-radius:8px 8px 0 0; display:flex; gap:5px;">
                        <button onclick="execCmd('bold')"><b>B</b></button>
                        <button onclick="execCmd('italic')"><i>I</i></button>
                        <button onclick="addLink()"><i class="fas fa-link"></i></button>
                    </div>
                    <div id="richEditor" class="rich-editor" contenteditable="true" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></div>
                </div>

                <!-- ImgBB Upload -->
                <div class="file-upload-box" onclick="document.getElementById('imgInput').click()" style="margin-top:10px;">
                    <i class="fas fa-camera" style="font-size:20px; color:var(--primary-color);"></i>
                    <div id="uploadText">‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)</div>
                </div>
                <input type="file" id="imgInput" hidden accept="image/*" onchange="uploadToImgBB(this)">
                <input type="hidden" id="postImage">

                <!-- Admin Only -->
                <div id="adminOptions" style="display:none; margin-top:10px; border-top:1px solid #ddd; padding-top:5px;">
                    <input type="text" id="voiceUrl" placeholder="Audio URL (MP3)">
                    <label><input type="checkbox" id="isPinned"> ‡¶™‡¶ø‡¶® ‡¶™‡ßã‡¶∏‡ßç‡¶ü</label>
                </div>

                <button class="btn btn-primary" id="submitBtn" onclick="handleSubmission()" style="margin-top:15px;">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:flex-end;">
                <button onclick="document.getElementById('profileModal').style.display='none'" style="border:none; background:none;"><i class="fas fa-times"></i></button>
            </div>
            
            <div id="profileContent" style="text-align:center;">
                <!-- Filled via JS -->
            </div>
            
            <h4 style="margin:10px 0;">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ó‡ßÅ‡¶≤‡ßã</h4>
            <div id="myPostsList" class="my-posts-list">
                <!-- User Posts -->
            </div>
            
            <button class="btn" onclick="logoutFunc()" style="background:#ffebee; color:red; margin-top:10px;">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
        </div>
    </div>

    <!-- Admin Panel (Secrets) -->
    <div id="adminPanel" class="modal-overlay">
        <div class="modal-content">
            <h3>‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶® ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (Admin)</h3>
            <div id="pendingList"></div>
            <button class="btn" onclick="document.getElementById('adminPanel').style.display='none'">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- JS Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBZtycgadrngON2WEwvIE7ERPYxdkDVfFM",
            authDomain: "muktolipidiary.firebaseapp.com",
            databaseURL: "https://muktolipidiary-default-rtdb.firebaseio.com",
            projectId: "muktolipidiary",
            storageBucket: "muktolipidiary.firebasestorage.app",
            messagingSenderId: "639103995400",
            appId: "1:639103995400:web:13528e51c0e86080770bbd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        window.currentUser = null;
        window.allPosts = [];
        window.pendingPosts = [];
        
        // --- Authentication ---
        onAuthStateChanged(auth, (user) => {
            window.currentUser = user;
            // Re-render to show/hide Edit buttons
            if(window.allPosts.length > 0) renderFeed(window.allPosts);
            updateNotifBadge();
        });

        window.login = () => signInWithPopup(auth, provider).then(() => {
            closeWriteModal(); openWriteModal(); showToast("‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤ ‚úÖ");
        });
        window.logoutFunc = () => signOut(auth).then(() => {
            document.getElementById('profileModal').style.display='none'; showToast("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá");
        });

        // --- Data Loading ---
        onValue(ref(db, 'posts'), (snapshot) => {
            document.getElementById('skeletonLoader').style.display = 'none';
            const data = snapshot.val();
            if (data) {
                const postsArr = Object.entries(data).map(([key, val]) => ({ key, ...val }));
                postsArr.sort((a, b) => {
                    if (a.isPinned && !b.isPinned) return -1;
                    if (!a.isPinned && b.isPinned) return 1;
                    return b.timestamp - a.timestamp;
                });
                window.allPosts = postsArr;
                renderFeed(postsArr);
                renderStories(postsArr);
                updateNotifBadge();
            } else {
                document.getElementById('feed').innerHTML = '<div style="text-align:center; padding:40px;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</div>';
            }
        });

        onValue(ref(db, 'pending_posts'), (snap) => {
            const data = snap.val();
            window.pendingPosts = data ? Object.entries(data).map(([k,v])=>({key:k, ...v})) : [];
            renderPending();
        });

        // --- Rendering ---
        function renderFeed(posts) {
            const feed = document.getElementById('feed');
            const isAdmin = localStorage.getItem('IS_ADMIN') === 'true';
            const uid = window.currentUser ? window.currentUser.uid : null;

            feed.innerHTML = posts.map(post => {
                const isOwner = uid && post.uid === uid;
                const liked = localStorage.getItem('LIKED_' + post.key);
                let body = post.content || '';
                const isLong = body.replace(/<[^>]*>/g, '').length > 200;

                return `
                <div class="post-card glass-panel" id="post-${post.key}">
                    ${post.isPinned ? '<i class="fas fa-thumbtack" style="position:absolute; top:15px; right:15px; color:red; transform:rotate(45deg);"></i>' : ''}
                    
                    <div class="author-info">
                        <div class="avatar-circle"><img src="${post.userImg || 'https://via.placeholder.com/40'}" onerror="this.src='https://via.placeholder.com/40'"></div>
                        <div>
                            <div style="font-weight:700; font-size:15px;">${post.author}</div>
                            <div style="font-size:11px; color:#666;">${post.date} ‚Ä¢ ${post.category || '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'}</div>
                        </div>
                    </div>

                    <h2 class="post-title">${post.title}</h2>

                    ${post.image ? `
                    <div class="post-img-container" ondblclick="handleDoubleTap('${post.key}')">
                        <i id="heart-${post.key}" class="fas fa-heart insta-heart"></i>
                        <img src="${post.image}" class="post-img" onclick="viewImage('${post.image}')">
                    </div>` : ''}

                    <div class="media-controls">
                        ${post.voice ? `<button class="media-btn" onclick="playAudio('${post.voice}','${post.title}','${post.author}')"><i class="fas fa-play"></i> ‡¶Ö‡¶°‡¶ø‡¶ì</button>` : ''}
                        <button class="media-btn" onclick="speakText('${post.key}')"><i class="fas fa-volume-up"></i> ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®</button>
                    </div>

                    <div class="content-preview">
                        <div class="read-more-wrapper ${isLong ? 'read-more-overlay' : 'expanded'}" id="wrap-${post.key}">
                            <div id="txt-${post.key}">${body}</div>
                        </div>
                        ${isLong ? `<button class="read-more-btn visible" onclick="toggleRead('${post.key}',this)">‡¶Ü‡¶∞‡¶ì ‡¶™‡ßú‡ßÅ‡¶®</button>` : ''}
                    </div>

                    <div class="interaction-bar">
                        <button id="likebtn-${post.key}" class="action-btn ${liked ? 'liked' : ''}" onclick="toggleLike('${post.key}', ${post.likes||0})">
                            <i class="fas fa-heart"></i> <span id="likecount-${post.key}">${post.likes||0}</span>
                        </button>
                        <button class="action-btn" onclick="toggleComments('${post.key}')"><i class="far fa-comment"></i> ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</button>
                        <div style="display:flex; gap:5px;">
                            <button class="action-btn" onclick="sharePost('${post.key}')"><i class="fas fa-share-alt"></i></button>
                            ${(isOwner || isAdmin) ? `
                                <button class="action-btn" onclick="editPost('${post.key}')"><i class="fas fa-edit"></i></button>
                                <button class="action-btn" onclick="deletePost('${post.key}')" style="color:red;"><i class="fas fa-trash"></i></button>
                            ` : ''}
                        </div>
                    </div>

                    <!-- Comments Area -->
                    <div id="comments-${post.key}" class="comments-container">
                        <input type="text" class="comment-input" placeholder="‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." onkeypress="if(event.key==='Enter') addComment('${post.key}', this)">
                        <div id="clist-${post.key}" style="margin-top:8px; font-size:13px;"></div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- Interaction Logic ---
        window.toggleLike = function(key, current) {
            const btn = document.getElementById(`likebtn-${key}`);
            const countSpan = document.getElementById(`likecount-${key}`);
            const isLiked = localStorage.getItem('LIKED_' + key);
            const postRef = ref(db, 'posts/' + key);

            if (isLiked) {
                update(postRef, { likes: Math.max(0, current - 1) });
                localStorage.removeItem('LIKED_' + key);
                btn.classList.remove('liked');
                countSpan.innerText = Math.max(0, current - 1);
            } else {
                update(postRef, { likes: current + 1 });
                localStorage.setItem('LIKED_' + key, 'true');
                btn.classList.add('liked');
                countSpan.innerText = current + 1;
                // Particle/Confetti effect could go here
            }
        };

        window.handleDoubleTap = function(key) {
            const heart = document.getElementById(`heart-${key}`);
            heart.classList.add('active');
            setTimeout(() => heart.classList.remove('active'), 1000);
            
            // Like if not already liked
            if (!localStorage.getItem('LIKED_' + key)) {
                const post = window.allPosts.find(p => p.key === key);
                if(post) window.toggleLike(key, post.likes || 0);
            }
        };

        // --- Write & ImgBB ---
        window.openWriteModal = function() {
            if(!window.currentUser) {
                document.getElementById('authRequiredMsg').style.display = 'block';
                document.getElementById('writeForm').style.display = 'none';
            } else {
                document.getElementById('authRequiredMsg').style.display = 'none';
                document.getElementById('writeForm').style.display = 'block';
                if(localStorage.getItem('IS_ADMIN') === 'true') document.getElementById('adminOptions').style.display = 'block';
            }
            document.getElementById('writeModalWrapper').style.display = 'flex';
        };
        window.closeWriteModal = function() { document.getElementById('writeModalWrapper').style.display = 'none'; clearForm(); };

        window.uploadToImgBB = function(input) {
            const file = input.files[0];
            if(!file) return;
            const txt = document.getElementById('uploadText');
            txt.innerText = "‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‚è≥";
            
            const formData = new FormData();
            formData.append('image', file);
            
            fetch('https://api.imgbb.com/1/upload?key=d34410bcea20d900a8a8bcc3068ac081', {
                method: 'POST', body: formData
            })
            .then(res => res.json())
            .then(data => {
                if(data.success) {
                    document.getElementById('postImage').value = data.data.url;
                    txt.innerHTML = "‚úÖ ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá";
                    txt.style.color = "green";
                } else {
                    txt.innerText = "‚ùå ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•";
                }
            })
            .catch(e => txt.innerText = "‚ùå ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + e.message);
        };

        window.handleSubmission = function() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('richEditor').innerHTML;
            const image = document.getElementById('postImage').value;
            const cat = document.getElementById('postCategory').value;
            const editKey = document.getElementById('editKey').value;
            
            if(!title || !content) return showToast("‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï");

            const postData = {
                title, content, image, category: cat,
                author: window.currentUser.displayName,
                uid: window.currentUser.uid,
                userImg: window.currentUser.photoURL,
                timestamp: Date.now(),
                date: new Date().toLocaleDateString('bn-BD'),
                likes: 0
            };

            // Admin extras
            if(localStorage.getItem('IS_ADMIN') === 'true') {
                postData.voice = document.getElementById('voiceUrl').value;
                postData.isPinned = document.getElementById('isPinned').checked;
            }

            if(editKey) {
                // Keep original data
                const old = window.allPosts.find(p=>p.key===editKey);
                postData.likes = old.likes || 0;
                postData.timestamp = old.timestamp; // keep original time
                update(ref(db, 'posts/'+editKey), postData).then(()=>{
                    showToast("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚úÖ"); closeWriteModal();
                });
            } else {
                if(localStorage.getItem('IS_ADMIN') === 'true') {
                    push(ref(db, 'posts'), postData).then(()=>{ showToast("‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶∂ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚úÖ"); closeWriteModal(); });
                } else {
                    push(ref(db, 'pending_posts'), postData).then(()=>{ showToast("‡¶∞‡¶ø‡¶≠‡¶ø‡¶â‡ßü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚è≥"); closeWriteModal(); });
                }
            }
        };

        window.deletePost = function(key) {
            Swal.fire({title:'‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?', icon:'warning', showCancelButton:true, confirmButtonText:'‡¶π‡ßç‡¶Ø‡¶æ‡¶Å'})
            .then(r => { if(r.isConfirmed) remove(ref(db, 'posts/'+key)); });
        };

        window.editPost = function(key) {
            const p = window.allPosts.find(x => x.key === key);
            openWriteModal();
            document.getElementById('postTitle').value = p.title;
            document.getElementById('richEditor').innerHTML = p.content;
            document.getElementById('postImage').value = p.image || '';
            document.getElementById('editKey').value = key;
            document.getElementById('submitBtn').innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü";
        };

        function clearForm() {
            document.getElementById('postTitle').value='';
            document.getElementById('richEditor').innerHTML='';
            document.getElementById('postImage').value='';
            document.getElementById('uploadText').innerText='‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)';
            document.getElementById('editKey').value='';
            document.getElementById('submitBtn').innerText="‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®";
        }

        // --- Admin Security ---
        let tapCount = 0;
        window.handleSecretTap = function() {
            tapCount++;
            setTimeout(()=> tapCount=0, 2000);
            if(tapCount === 5) {
                Swal.fire({
                    title: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤',
                    input: 'password',
                    inputPlaceholder: '‡¶™‡¶ø‡¶® ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®',
                    showCancelButton: true
                }).then(res => {
                    if(res.value === '1234') {
                        localStorage.setItem('IS_ADMIN', 'true');
                        document.getElementById('adminPanel').style.display='flex';
                        renderFeed(window.allPosts); // Refresh buttons
                    } else if(res.value) {
                        Swal.fire('‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®', '', 'error');
                    }
                });
            }
        };

        function renderPending() {
            const list = document.getElementById('pendingList');
            if(!window.pendingPosts.length) return list.innerHTML = "‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á";
            list.innerHTML = window.pendingPosts.map(p => `
                <div style="background:#fff; padding:10px; margin-bottom:5px; border-radius:5px;">
                    <b>${p.title}</b> by ${p.author}
                    <div style="margin-top:5px;">
                        <button onclick="approve('${p.key}')" style="color:green;">‚úî Approve</button>
                        <button onclick="reject('${p.key}')" style="color:red;">‚úò Reject</button>
                    </div>
                </div>
            `).join('');
        }
        window.approve = (key) => {
            const p = window.pendingPosts.find(x=>x.key===key);
            const {key:_, ...data} = p;
            push(ref(db, 'posts'), data).then(()=> remove(ref(db, 'pending_posts/'+key)));
        };
        window.reject = (key) => remove(ref(db, 'pending_posts/'+key));

        // --- User Profile ---
        window.navTo = function(page, btn) {
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            if(btn && !btn.classList.contains('nav-center-btn')) btn.classList.add('active');
            
            if(page === 'home') { window.scrollTo(0,0); renderFeed(window.allPosts); }
            if(page === 'search') document.getElementById('searchBar').focus();
            if(page === 'notifications') showToast("‡¶ï‡ßã‡¶®‡ßã ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡ßá‡¶á");
            if(page === 'profile') openProfile();
        };

        function openProfile() {
            if(!window.currentUser) { showToast("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®"); window.login(); return; }
            
            const u = window.currentUser;
            const myPosts = window.allPosts.filter(p => p.uid === u.uid);
            
            document.getElementById('profileContent').innerHTML = `
                <img src="${u.photoURL}" class="profile-img-lg">
                <h3>${u.displayName}</h3>
                <div class="profile-stat-box">
                    <span>üìù ${myPosts.length} ‡¶ü‡¶ø ‡¶≤‡ßá‡¶ñ‡¶æ</span>
                    <span>üìÖ ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®: ${new Date(u.metadata.creationTime).toLocaleDateString()}</span>
                </div>
            `;
            
            document.getElementById('myPostsList').innerHTML = myPosts.map(p => `
                <div class="my-post-item">
                    <span style="font-size:14px; font-weight:600;">${p.title}</span>
                    <div>
                        <button onclick="editPost('${p.key}'); document.getElementById('profileModal').style.display='none'" style="border:none; color:blue;"><i class="fas fa-edit"></i></button>
                        <button onclick="deletePost('${p.key}')" style="border:none; color:red;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('profileModal').style.display = 'flex';
        }

        // --- Utilities ---
        window.execCmd = (c, v=null) => document.execCommand(c, false, v);
        window.addLink = () => { const url=prompt('URL:'); if(url) execCmd('createLink', url); };
        window.toggleRead = (key, btn) => {
            const w = document.getElementById('wrap-'+key);
            w.classList.toggle('expanded');
            w.classList.toggle('read-more-overlay');
            btn.innerText = w.classList.contains('expanded') ? '‡¶ï‡¶Æ‡¶ø‡ßü‡ßá ‡¶™‡ßú‡ßÅ‡¶®' : '‡¶Ü‡¶∞‡¶ì ‡¶™‡ßú‡ßÅ‡¶®';
        };
        window.showToast = (msg) => {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000);
        };
        
        // Notification Badge Logic
        function updateNotifBadge() {
            const lastVisit = localStorage.getItem('LAST_VISIT') || 0;
            const newPosts = window.allPosts.filter(p => p.timestamp > lastVisit).length;
            const badge = document.getElementById('notifBadge');
            badge.innerText = newPosts;
            badge.className = newPosts > 0 ? 'badge active' : 'badge';
        }
        document.querySelector('[onclick="navTo(\'notifications\', this)"]').addEventListener('click', () => {
            localStorage.setItem('LAST_VISIT', Date.now());
            updateNotifBadge();
        });

        // Stories, Filters, Audio (Simplified for length)
        window.filterCategory = (cat, btn) => {
            document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            if(cat==='‡¶∏‡¶¨') renderFeed(window.allPosts);
            else if(cat==='‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡ßü') renderFeed([...window.allPosts].sort((a,b)=>b.likes-a.likes));
            else renderFeed(window.allPosts.filter(p=>p.category===cat));
        };
        
        window.renderStories = (posts) => {
            const container = document.getElementById('storiesBar');
            const authors = [...new Set(posts.map(p=>p.author))].slice(0,10);
            container.innerHTML = authors.map(a => {
                const p = posts.find(x=>x.author===a);
                return `<div class="story-item" onclick="filterPosts('${a}')">
                    <div class="story-ring"><img src="${p.userImg||'https://via.placeholder.com/50'}" class="story-img"></div>
                    <span class="story-name">${a}</span>
                </div>`
            }).join('');
        };
        window.filterPosts = (q) => {
            const term = q.toLowerCase();
            renderFeed(window.allPosts.filter(p=> p.title.toLowerCase().includes(term) || p.author.toLowerCase().includes(term)));
        };
    </script>
</body>
</html>